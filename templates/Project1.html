<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Scraper</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styleNavbar.css') }}" />

    <style>
      .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.6);justify-content:center;align-items:center}.modal-content{background-color:#fefefe;margin:auto;padding:30px;border:1px solid #888;width:80%;max-width:400px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.3);position:relative;animation:fadeIn .3s}@keyframes fadeIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}.close-btn{color:#aaa;position:absolute;top:10px;right:20px;font-size:28px;font-weight:bold}.close-btn:hover,.close-btn:focus{color:black;text-decoration:none;cursor:pointer}.modal-content h2{margin-top:0;margin-bottom:20px;text-align:center}.modal-form .form-row{margin-bottom:15px}.modal-form input[type="text"],.modal-form input[type="password"]{width:100%;padding:10px;box-sizing:border-box}.modal-form input[type="submit"]{width:100%;padding:12px;font-size:16px}#login-status{font-weight:bold;color:#2c5282;margin-right:15px;}.error-message{color:red;text-align:center;margin-top:10px;}
    </style>
  </head>
  <body>
    <div class="navbar">
      <h1>Comoter</h1>
      <button class="menu-toggle" onclick="toggleMenu()">☰</button>
      <div class="nav-links" id="navLinks">
        <a href="#">Home</a>
        <a href="https://wa.me/6281336900579">Contact</a>
        <a href="https://www.linkedin.com/in/boni-mulia-putra-293704272/">Portfolio</a>
        <span id="login-status" style="display: none;"></span> 
        <a href="#" id="loginBtn">Login</a>
        <a href="#" id="logoutBtn" style="display: none;">Logout</a>
      </div>
    </div>

    <div class="main-container-button">
      <a href="{{ url_for('manual') }}">Emanuel</a>
    </div>
    <div class="container">
        <div class="header"><h1>PROJECT 1</h1><p>"Catatan: Web ini tidak menyimpan data secara permanen."</p></div>
        <div class="section"><h2>ABOUT ME</h2><p>Make sure you read emanuel</p></div>
        <div class="section">
            <h2>PENCARIAN</h2>
            <form method="POST" action="/scrape">
                <div class="form-row"><label for="scrape_mode">Mode Scraping:</label><select name="scrape_mode" id="scrape_mode"><option value="list">🔎 Halaman Daftar Judul</option><option value="detail">📄 Langsung ke Halaman Judul</option></select></div>
                <div class="form-row" id="url-group"><label id="url-label" for="url-input">Masukkan URL:</label><input type="text" name="url" id="url-input" placeholder="https://repository.upnjatim.ac.id/16186/" /></div>
                <div class="form-row" id="jurusan-group"><label for="jurusanInput">Pilihlah Jurusan:</label><input list="jurusanList" id="jurusanInput" type="text" name="jurusan" placeholder="Mulai ketik untuk mencari..." /><datalist id="jurusanList"></datalist></div>
                <div class="form-row"><label for="keyword">Kata Kunci:</label><input type="text" name="keyword" id="keyword" placeholder="Contoh: silika" required /></div>
                <div id="list-options">
                    <div class="form-row"><label for="anchor_name">Nama Anchor (Opsional):</label><input list="anchorList" type="text" name="anchor_name" id="anchor_name" placeholder="Contoh: group_thesis" /><datalist id="anchorList"></datalist></div>
                    <div class="form-row"><label for="start_index">Mulai dari urutan ke-:</label><input type="number" name="start_index" id="start_index" value="0" min="0" /></div>
                    <div class="form-row"><label for="limit">Batas jumlah JUDUL:</label><input type="number" name="limit" id="limit" value="3" min="1" /></div>
                </div>
                <div class="form-actions"><a href="{{ url_for('hasil') }}" id="view-last-results-btn" class="button-secondary" style="display: none;">Buka Hasil Terakhir</a><input type="submit" value="🔍 Cari" /></div>
            </form>
        </div>
    </div>

    <div id="loginModal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Login ke Repository</h2>
        <form id="login-form" class="modal-form">
          <div class="form-row">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
          </div>
          <div class="form-row">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
          </div>
          <div class="form-actions">
            <input type="submit" value="Login">
          </div>
          <div id="error-message-container" class="error-message"></div>
        </form>
      </div>
    </div>

    <script>
      // --- FUNGSI INI DIPERBAIKI ---
      // Fungsi ini akan menambah/menghapus kelas '.show' pada div navLinks
      // yang kemudian akan diatur oleh styleNavbar.css
      function toggleMenu() {
        const navLinks = document.getElementById('navLinks');
        navLinks.classList.toggle('show');
      }
      
      document.addEventListener('DOMContentLoaded', function () {
        // Semua parameter dan logika Anda yang lain tidak diubah
        const inputsToSave = ['scrape_mode', 'jurusanInput', 'keyword', 'start_index', 'limit', 'url-input', 'anchor_name'];
        inputsToSave.forEach((id)=>{ const el=document.getElementById(id); if(el){el.value=localStorage.getItem(id)||el.value;el.addEventListener(el.tagName.toLowerCase()==='select'?'change':'input',()=>localStorage.setItem(id,el.value))}});
        const modeSelect=document.getElementById('scrape_mode'),listOptions=document.getElementById('list-options'),urlGroup=document.getElementById('url-group'),jurusanGroup=document.getElementById('jurusan-group');
        function u(){modeSelect.value==='list'?(listOptions.style.display='flex',jurusanGroup.style.display='grid',urlGroup.style.display='none'):(listOptions.style.display='none',jurusanGroup.style.display='none',urlGroup.style.display='grid')}
        modeSelect.addEventListener('change',u);u();
        fetch('/data-jurusan').then(r=>r.json()).then(d=>{const l=document.getElementById('jurusanList');Object.keys(d).forEach(n=>{const o=document.createElement('option');o.value=n;l.appendChild(o)})});
        fetch('/data-anchor').then(r=>r.json()).then(d=>{const l=document.getElementById('anchorList');d.forEach(n=>{const o=document.createElement('option');o.value=n;l.appendChild(o)})});
        if(localStorage.getItem('savedResultsHTML')){document.getElementById('view-last-results-btn').style.display='inline-block'}
        const modal=document.getElementById('loginModal'),loginBtn=document.getElementById('loginBtn'),logoutBtn=document.getElementById('logoutBtn'),closeBtn=document.querySelector('.close-btn'),loginForm=document.getElementById('login-form'),loginStatusEl=document.getElementById('login-status'),errorContainer=document.getElementById('error-message-container');
        function updateLoginUI(l,u=''){l?(loginStatusEl.textContent=`Login sebagai: ${u}`,loginStatusEl.style.display='inline',loginBtn.style.display='none',logoutBtn.style.display='inline'):(loginStatusEl.style.display='none',loginBtn.style.display='inline',logoutBtn.style.display='none')}
        fetch('/check-status').then(r=>r.json()).then(d=>updateLoginUI(d.logged_in,d.username));
        loginBtn.onclick=e=>{e.preventDefault();modal.style.display='flex';errorContainer.textContent=''};
        closeBtn.onclick=()=>modal.style.display='none';
        window.onclick=e=>{if(e.target==modal)modal.style.display='none'};
        loginForm.onsubmit=function(e){e.preventDefault();errorContainer.textContent='Mencoba login...';const d=new FormData(loginForm);fetch('/login',{method:'POST',body:d}).then(r=>r.json()).then(t=>{t.success?(modal.style.display='none',updateLoginUI(!0,d.get('username')),alert(t.message)):errorContainer.textContent=t.message}).catch(r=>{errorContainer.textContent='Terjadi kesalahan jaringan.'})};
        logoutBtn.onclick=function(e){e.preventDefault();fetch('/logout').then(r=>r.json()).then(d=>{if(d.success){updateLoginUI(!1);alert(d.message)}})};
      });
    </script>
  </body>
</html>